#!/bin/tcsh -xef

## Set up
# If fingermaps change subj from numbered to P00 standard - i.e., subj will be P00_XX and subj_old will be Pnumber_XX
# If other experimental, subj and subj old will be the same (numbered)
set subj_init = LV
set subj = P003_{$subj_init}
# set subj_old = P002_{$subj_init}
set subj_old = $subj

# MUST CHANGE: Is 'ash' or 'me'
set whose_data = me


# Leave this as non SS image, non unifized - will copy this full anat, unifized and SS one later on
set anat = {$subj_init}_uniden_avg
set anat_dir = /scratch/inode/uqhdemp1/Data/Anatomicals/{$subj_init}
# set raw_data_dir = /scratch/inode/uqhdemp1/Data/Fingertip_maps/Nifti/{$subj_old}
set raw_data_dir = /scratch/inode/uqhdemp1/Data/Columns_data/{$subj_old}
# set output_dir = /scratch/inode/uqhdemp1/Fingertip_maps/{$subj}/$subj.results
set output_dir = /scratch/inode/uqhdemp1/Columns_analysis/{$subj}/$subj.results

## Set stuff that varies between mine/ Ash data collection (though TR counts = same)
if ($whose_data == ash) then
	set raw_data = RUN
	set TR = 1.992
endif

if ($whose_data == me) then
	set raw_data = r0
	set TR = 1.920
endif

set TR_count = 336
set tr_counts = ( $TR_count $TR_count $TR_count $TR_count $TR_count $TR_count )


echo "auto-generated by afni_proc.py, Tue Nov 23 15:53:22 2021"
echo "(version 7.12, April 14, 2020)"
echo "execution started: `date`"


# =========================== auto block: setup ============================
# script setup

# take note of the AFNI version
afni -ver

# check that the current AFNI version is recent enough
afni_history -check_date 27 Jun 2019
if ( $status ) then
    echo "** this script requires newer AFNI binaries (than 27 Jun 2019)"
    echo "   (consider: @update.afni.binaries -defaults)"
    exit
endif

# the user may specify a single subject to run with
if ( $#argv > 0 ) then
    set subj = $argv[1]
else
    set subj = $subj
endif

# verify that the results directory does not yet exist
if ( -d $output_dir ) then
    echo output dir "$subj.results" already exists
    exit
endif

# create results and stimuli directories
mkdir $output_dir
mkdir $output_dir/stimuli

# copy anatomy to results dir - change to BRIK HEAD
## Do first for full anat
3dcopy \
    {$anat_dir}/{$anat}_uni.nii \
    $output_dir/{$anat}_uni

## Then for MY good SS anat - change to BRIK HEAD
3dcopy \
    {$anat_dir}/{$anat}_uni_SS.nii \
    $output_dir/{$anat}_uni_SS

## For some Ash subs with noise - copy non unifized anat
# 3dcopy \
#    {$anat_dir}/Previous_steps/{$anat}.nii \
#    $output_dir/{$anat}

# ============================ auto block: tcat ============================
# apply 3dTcat to copy input dsets to results dir,
# while removing the first 0 TRs
3dTcat -prefix $output_dir/pb00.$subj.r01.tcat \
    {$raw_data_dir}/{$subj_old}_{$raw_data}1.nii'[0..$]'
3dTcat -prefix $output_dir/pb00.$subj.r02.tcat \
    {$raw_data_dir}/{$subj_old}_{$raw_data}2.nii'[0..$]'
3dTcat -prefix $output_dir/pb00.$subj.r03.tcat \
    {$raw_data_dir}/{$subj_old}_{$raw_data}3.nii'[0..$]'
3dTcat -prefix $output_dir/pb00.$subj.r04.tcat \
    {$raw_data_dir}/{$subj_old}_{$raw_data}4.nii'[0..$]'
3dTcat -prefix $output_dir/pb00.$subj.r05.tcat \
    {$raw_data_dir}/{$subj_old}_{$raw_data}5.nii'[0..$]'
3dTcat -prefix $output_dir/pb00.$subj.r06.tcat \
    {$raw_data_dir}/{$subj_old}_{$raw_data}6.nii'[0..$]'

#### Manual edit: Change TR values
3drefit -TR $TR $output_dir/pb00.$subj.r01.tcat+orig
3drefit -TR $TR $output_dir/pb00.$subj.r02.tcat+orig
3drefit -TR $TR $output_dir/pb00.$subj.r03.tcat+orig
3drefit -TR $TR $output_dir/pb00.$subj.r04.tcat+orig 
3drefit -TR $TR $output_dir/pb00.$subj.r05.tcat+orig
3drefit -TR $TR $output_dir/pb00.$subj.r06.tcat+orig

# -------------------------------------------------------
# enter the results directory (can begin processing data)
# cd $output_dir


